<div class="slide">
    <h1>Real Example: Robot/Drone Heading Control</h1>
    
    <div class="problem-setup">
        <h3>🤖 The Scenario</h3>
        <p>PID controller needs to turn robot from 350° to 10°</p>
    </div>
    
    <div class="visual-comparison">
        <div class="approach bad-approach">
            <h4>❌ Naive PID Error</h4>
            <svg width="500" height="500" viewBox="0 0 250 250">
                <circle cx="125" cy="125" r="100" fill="none" stroke="var(--charcoal)" stroke-width="2"/>
                
                <!-- Current heading: 350° -->
                <line x1="125" y1="125" x2="115" y2="25" stroke="var(--digital-teal)" stroke-width="4"/>
                <circle cx="115" cy="25" r="6" fill="var(--digital-teal)"/>
                <text x="75" y="15" font-size="12" fill="var(--digital-teal)">Current: 350°</text>
                
                <!-- Target heading: 10° -->
                <line x1="125" y1="125" x2="135" y2="25" stroke="var(--flora-green)" stroke-width="4"/>
                <circle cx="135" cy="25" r="6" fill="var(--flora-green)"/>
                <text x="175" y="15" font-size="12" fill="var(--digital-teal)">Target: 10°</text>
                
                <!-- Wrong rotation path (counter-clockwise the long way) -->
                <path d="M 115 25 A 100 100 0 1 0 135 25" fill="none" stroke="var(--flora-green)" stroke-width="5" stroke-dasharray="10,5"/>

                <!-- Simple direction indicator for counter-clockwise motion -->
                <text x="60" y="60" font-size="20" fill="var(--flora-green)">↺</text>
                <text x="35" y="75" font-size="9" fill="var(--flora-green)">340°</text>

                <!-- Label showing this is the wrong way -->
                <text x="25" y="125" font-size="18" fill="var(--flora-green)">↺</text>
                <text x="10" y="140" font-size="9" fill="var(--flora-green)" font-weight="bold">340° CCW</text>
                <text x="5" y="150" font-size="9" fill="var(--flora-green)">WRONG WAY</text>
                <text x="125" y="200" text-anchor="middle" font-size="14" fill="var(--flora-green)" font-weight="bold">
                    Error: -340°
                </text>
                <text x="125" y="220" text-anchor="middle" font-size="12" fill="var(--flora-green)">
                    Spins backward!
                </text>
            </svg>
            
            <pre><code>error = target - current
error = 10 - 350 = -340°
# Robot spins almost full circle
# the wrong way!</code></pre>
        </div>
        
        <div class="approach good-approach">
            <h4>✅ Embedded Solution</h4>
            <svg width="500" height="500" viewBox="0 0 250 250">
                <circle cx="125" cy="125" r="100" fill="none" stroke="var(--charcoal)" stroke-width="2"/>
                
                <!-- Current heading: 350° -->
                <line x1="125" y1="125" x2="115" y2="25" stroke="var(--digital-teal)" stroke-width="4"/>
                <circle cx="115" cy="25" r="6" fill="var(--digital-teal)"/>
                <text x="75" y="15" font-size="12" fill="var(--digital-teal)">Current: 350°</text>
                
                <!-- Target heading: 10° -->
                <line x1="125" y1="125" x2="135" y2="25" stroke="var(--flora-green)" stroke-width="4"/>
                <circle cx="135" cy="25" r="6" fill="var(--flora-green)"/>
                <text x="175" y="15" font-size="12" fill="var(--digital-teal)">Target: 10°</text>
                
                <!-- Correct rotation path (short clockwise way) -->
                <path d="M 115 25 A 100 100 0 0 1 135 25" fill="none" stroke="var(--flora-green)" stroke-width="6"/>

                <!-- Simple direction indicator for clockwise motion -->
                <text x="170" y="60" font-size="20" fill="var(--flora-green)">↻</text>
                <text x="180" y="75" font-size="9" fill="var(--flora-green)">20°</text>

                <!-- Label showing this is the right way -->
                <text x="225" y="125" font-size="18" fill="var(--flora-green)">↻</text>
                <text x="215" y="140" font-size="9" fill="var(--flora-green)" font-weight="bold">20° CW</text>
                <text x="210" y="150" font-size="9" fill="var(--flora-green)">RIGHT WAY</text>
                <text x="125" y="200" text-anchor="middle" font-size="14" fill="var(--flora-green)" font-weight="bold">
                    Error: +20°
                </text>
                <text x="125" y="220" text-anchor="middle" font-size="12" fill="var(--flora-green)">
                    Efficient turn!
                </text>
            </svg>
            
            <pre><code>def heading_error(current, target):
    c_vec = [cos(current), sin(current)]
    t_vec = [cos(target), sin(target)]
    return atan2(cross(c_vec, t_vec), 
                 dot(c_vec, t_vec))
# Returns: +20° (shortest path!)</code></pre>
        </div>
    </div>
    
    <div class="implementation">
        <h3>Complete PID Controller Fix</h3>
        <pre><code class="language-python">class HeadingController:
    def __init__(self, kp=1.0, ki=0.1, kd=0.05):
        self.kp, self.ki, self.kd = kp, ki, kd
        self.integral = 0
        self.last_error = 0
        
    def compute_control(self, current_heading, target_heading, dt):
        # Embed both headings as vectors
        current_vec = np.array([np.cos(current_heading), np.sin(current_heading)])
        target_vec = np.array([np.cos(target_heading), np.sin(target_heading)])
        
        # Compute signed angle error (always shortest path)
        error = np.arctan2(
            current_vec[0] * target_vec[1] - current_vec[1] * target_vec[0],
            current_vec[0] * target_vec[0] + current_vec[1] * target_vec[1]
        )
        
        # Standard PID computation (now with correct error!)
        self.integral += error * dt
        derivative = (error - self.last_error) / dt
        
        control = self.kp * error + self.ki * self.integral + self.kd * derivative
        self.last_error = error
        
        return control  # Angular velocity command</code></pre>
    </div>
    
    <div class="impact-note">
        <p>💰 <strong>Real Impact:</strong> Shipping routes crossing the Pacific get drawn spanning ~359° longitude instead of the short ~20 nautical mile path due to antimeridian wraparound bugs in mapping SDKs</p>
    </div>
</div>

